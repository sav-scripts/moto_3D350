<script type="x-shader/x-vertex" id="vertex">

    attribute float lineType;
    attribute float randomSeed;
    attribute float speed;

    varying vec2 vUv;
    varying float vLineType;
    varying float vRandomSeed;
    varying float vSpeed;


    void main()
    {
        vUv = uv;
        vLineType = lineType;
        vRandomSeed = randomSeed;
        vSpeed = speed;
        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
    }

</script>

<script type="x-shader/x-fragment" id="fragment">

    //uniform sampler2D texture;

    uniform float time;

    //varying vec4 vColor;
    varying vec2 vUv;

    varying float vLineType;
    varying float vRandomSeed;
    varying float vSpeed;

    float quadOut(float t, float b, float c, float d)
    {
        t /= d;
        return -c * t*(t-2.0) + b;
    }

    float quardInOut(float t, float b, float c, float d)
    {
        t /= d/2.0;
        if (t < 1.0) return c/2.0*t*t*t*t + b;
        t -= 2.0;
        return -c/2.0 * (t*t*t*t - 2.0) + b;
    }


    #define M_PI 3.1415926535897932384626433832795

    void main() {



        //float alpha = (1.0 - abs(quardInOut(vUv.x, -1.0, 2.0, 1.0))) * .09;

        float alpha = 1.0;
        float GLOW_VOLUME = 5.0;

        float mark = mod(time * vSpeed + vRandomSeed, 1.0);
        if(vRandomSeed > .5) mark = 1.0 - mark;

        float d, factor;

        if(vLineType == .0)
        {
            //alpha = (1.0 - abs(quardInOut(vUv.x, -1.0, 2.0, 1.0)))*.09;

            d = abs(vUv.y - mark);
            if(d > .05) d = 1.0 - d;
            factor = smoothstep(.05, .0, d)*GLOW_VOLUME + 1.0;

            alpha = (1.0 - abs(quardInOut(vUv.x, -1.0, 2.0, 1.0)))*.09 * factor;
        }
        else
        {
            //alpha = (1.0 - abs(quardInOut(vUv.y, -1.0, 2.0, 1.0))) * .09;

            d = abs(vUv.x - mark);
            if(d > .025) d = 1.0 - d;
            factor = smoothstep(.025, .0, d)*GLOW_VOLUME + 1.0;
            alpha = (1.0 - abs(quardInOut(vUv.y, -1.0, 2.0, 1.0))) * .09 * factor;
        }

        vec3 color = vec3(1.0, .8, .0);

        gl_FragColor = vec4(color, alpha);

    }

</script>